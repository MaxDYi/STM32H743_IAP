# STM32H743内部Flash

## Flash架构

Flash 为 266 位的 Flash 字存储器，用于存储代码和数据常量。每个字包括：

- 一个 Flash 字（8 个字、32 个字节或 256 位）。
- 10 个 ECC 位。

Flash 分为两个独立的存储区。每个存储区的构成如下：

- 1 MB 的用户 Flash 块，包括八个 128 KB 的用户扇区（4 K Flash 字）。
- 128 KB 的系统 Flash，器件可从该 Flash 启动：此区域包含根安全服务 (root secure services, RSS) 和自举程序，两者分别用于通过USART、USB (DFU)、I2C、SPI 或以太网接口进行安全或非安全 Flash 编程。系Flash 留给意法半导体使用。它由意法半导体在器件制造期间编程并加以保护以防止误编程/误擦除操作。更多详细信息，请参见 http://www.st.com 上提供的应用笔记 AN2606《STM32 微控制器系统 Flash 启动模式》。
- 2 KB（64 个 Flash 字）的用户选项字节，用于进行用户配置：此区域仅在存储区 1 中可用。与用户 Flash 和系统 Flash 不同，该区域并未映射到任何存储器地址，并且仅可通过 Flash 寄存器接口进行访问。

## Flash区域分配

| Flash区域  |  起始地址   |  结束地址   | 大小（字节） |
| :--------: | :---------: | :---------: | :----------: |
| Bootloader | 0x0800_0000 | 0x0801_FFFF |     128K     |
|    App1    | 0x0802_0000 | 0x080F_FFFF |     896K     |
|    App2    | 0x0810_0000 | 0x081D_FFFF |     896K     |
| Parameter  | 0x081E_0000 | 0x081F_FFFF |     128K     |

## Parameter区域设置

|    参数     |  起始地址   |  结束地址   | 大小（字节） |          备注          |
| :---------: | :---------: | :---------: | :----------: | :--------------------: |
|  BootInit   | 0x081E_0000 | 0x081E_0003 |      4       | 非0x01时写入初始化配置 |
|  BootFlag   | 0x081E_0004 | 0x081E_0007 |      4       |                        |
| App1Verison | 0x081E_0008 | 0x081E_000B |      4       |                        |
| App2Verison | 0x081E_000C | 0x081E_000F |      4       |                        |
|  App1Name   | 0x081E_0010 | 0x081E_008F |     128      |                        |
|  App2Name   | 0x081E_0090 | 0x081E_010F |     128      |                        |

### BootFlag含义

| Flag值 |                含义                |        Bootloader操作        |
| :----: | :--------------------------------: | :--------------------------: |
|   0    |           启动时跳转App1           |        校验App1后启动        |
|   1    |           启动时跳转App2           |        校验App2后启动        |
|   2    | 固件下载，需要校验后跳转新固件App1 | 校验App1，成功Flag置0失败置1 |
|   3    | 固件下载，需要校验后跳转新固件App2 | 校验App2，成功Flag置1失败置0 |

